pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
 snake={
  x=15,
  y=15,
  sx=1,
  sy=0,
  tail={},
  total=0
 }
 
 gs={
  tick=0,
  maxtick=60,
  speed=10,
  fade_speed=1,
  debug={},
  
  mode="",
  title="sand-snake"
 }
 
 scl=4
 pill={}
 rndpill()
 
 setmode("start")
end

function _update60()
 gs.debug={}
 
 if gs.mode=="start" then
  update_start()
 elseif gs.mode=="game" then
  update_game()
 elseif gs.mode=="dead" then
  update_dead()
 end
end

function _draw()
 if gs.mode=="start" then
  draw_start()
 elseif gs.mode=="game" then
  draw_game()
 elseif gs.mode=="dead" then
  draw_dead()
 end
 
 for _,v in pairs(gs.debug) do
  color(0)
  print(v)
 end
end

function setmode(mode)
 if mode=="start" then
  music(0)
  gs.mode=mode
 elseif mode=="game" then
  music(3)
  gs.mode=mode
  snake.total=0
  snake.tail={}
 elseif mode=="dead" then
  music(2)
  gs.mode=mode
 end
 
 pal()
 cls(0)
 gs.tick=0
end

function debug(str)
 add(gs.debug,str)
end
-->8
-- logic

function tick()
 add(snake.tail,{snake.x,snake.y})
 
 while #snake.tail>snake.total do
  deli(snake.tail,1)
 end

 snake.x+=snake.sx
 snake.y+=snake.sy
 
 --snake.x=mid(0,snake.x,127\scl)
 --snake.y=mid(0,snake.y,127\scl)
 
 snake.x=snake.x%(128\scl)
 snake.y=snake.y%(128\scl)
 
 if collide(snake.x,snake.y,pill[1],pill[2]) then
  sfx(0)
  snake.total+=1
  rndpill()
 end
 
 if collide_tail(snake.x,snake.y) then
  setmode("dead")
 end
end

function rndpill()
 local x,y=pill[1],pill[2]
 while collide(pill[1],pill[2],x,y) or collide_tail(pill[1],pill[2]) do
  x,y=flr(rnd(127\scl)),flr(rnd(127\scl))
 end
 pill={x,y}
end

function collide(x0,y0,x1,y1)
 return x0==x1 and y0==y1
end

function collide_tail(x,y)
 for _,t in pairs(snake.tail) do
  if collide(x,y,t[1],t[2]) then
   return true
  end
 end
end

function update_start()
 if gs.tick>0 then
  if gs.tick>=gs.maxtick then
   setmode("game")
   return
  end
  
  gs.tick+=gs.fade_speed
 else
  if btnp(❎) then
	  sfx(1)
	  gs.tick=1
	 end
 end
end

function update_game()
 if btnp(⬆️) then
  snake.sx=0 snake.sy=-1
 elseif btnp(⬇️) then
  snake.sx=0 snake.sy=1
 elseif btnp(⬅️) then
  snake.sx=-1 snake.sy=0
 elseif btnp(➡️) then
  snake.sx=1 snake.sy=0
 end
 
 debug(snake.total)
 
 gs.tick+=gs.speed
 if gs.tick>=gs.maxtick then
  gs.tick=0
  tick()
 end
end

function update_dead()
 if btnp(❎) then
  setmode("start")
  return
 end

 gs.tick+=4
 if gs.tick>=gs.maxtick then
  gs.tick=0
 end
end
-->8
-- draw
function draw_start()
 if gs.tick<=0 then
  cls(0)
  sspr(0,8,127,90,0,127-90)
  
  local sw,sh=#gs.title*4,6
  local x,y=128/2-sw\2,128/2-sh\2-16
  printwob(gs.title,x,y,4,0.5,1)
  printwob(gs.title,x,y,5,0.5,2)
  printwob(gs.title,x,y,6,0.5,4)
  printwob(gs.title,x,y,7,0.5,9)
  printwob(gs.title,x,y,8,0.5,12)
  printwob(gs.title,x,y,9,0.5,6)
  printwob(gs.title,x,y,10,0.5,7)
  
  local msg="press ❎ to start"
  sw,sh=#msg*4,6
  x,y=128/2-sw\2,100
  
  printwob(msg,x,y+1,3,0.3,5)
  printwob(msg,x,y,3,0.3,7)
 else
  local flsh=flr(time()*10)%2
  cls(flsh*5)
 end
end

function printwob(str,x,y,of,spd,col)
 local woby=sin(time()*spd)
 print(str,x,y+flr(of*woby),col)
end

function draw_game()
 cls(1)
 
 for _,tail in pairs(snake.tail) do
  drawseg(tail[1],tail[2],15)
 end
 
 drawseg(pill[1],pill[2],12)
 drawseg(snake.x,snake.y,14)
end

function draw_dead()
 if gs.tick==0 then
  cls(10)
	 for i=0,16 do
	  local r=flr(rnd(3))+11 
	  local msg="game over"
	  
	  if rnd()<0.1 then
	   msg="dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead dead"
	  end
	  
	  printrnd(msg,r)
	 end
 end
 
 pal(10,choice({8,136}),1)
 
 pal(11,choice({7,136,8}),1)
 pal(12,choice({7,136,8}),1)
 pal(13,choice({7,136,8}),1)
 
 local msg="press ❎ to restart"
 local sw=#msg*4
 local x,y=(64-sw\2),64
 print(msg,x,y-1,7)
 print(msg,x,y+1,7)
 print(msg,x,y,0)
end

function printrnd(str,col)
 local x,y=flr(rnd(256)-128),flr(rnd(256)-128)
 print(str,x,y,col)
end

function choice(arr)
 local r=flr(rnd(#arr))+1
 --debug(r)
 return arr[r]
end

function drawseg(x,y,col)
 rectfill(x*scl,y*scl,(x+1)*scl-1,(y+1)*scl-1,col)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000ee72eeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000fffffffff2e2ee7e2eee7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ffffff9fffffeeeee2eee2ee2e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000fffffffffff9feeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffffff9ffffffeeeeeeeeeeeeeeeee0000000000000000000000000422200000000000000000000000000000000000000000000000000000000000
000000ffffff9ffffffffffeeeeeee7eeeeeeee2e000000000000000000000004422120000000000000000000000000000000000000000000000000000000000
00000fff9fffffffffff9ffeeeeeeeeeeeee7eeee000000000000000000000244422122000000000000000000000000000000000000000000000000000000000
0000f9fff9ffff9ffff99ffeeeeeeeeeeee22ee72e00000000000000000002442221211210000000000000000000000000000000000000000000000000000000
000fffffffffff9ff9ff9f9feeee7eee2eeee7222e00000000000000000024424212222100000000000000000000000000000000000000000000000000000000
00fffffffffff99f99f9999feeee2eeeeeee22eee200000000000000000242442112111101010000000000000000000000000000000000000000000000000000
00fffffffffff99f9ff9f9f9eeeeeeeee222e2e22200000000000000022424412221111100011000000000000000000000000000000000000000000000000000
0ffffff99fff999f999999f9222e22e9e22222222900000000000000244424222211111110001100000000000000000000000000000420000000000000000000
0ffff9ffffff9999000000090222e22922e2e2222900000000000002422441211111111110000001000000000000000000000000004222000000000000000000
0fffffffff9990090000000900022229222229200900000000000224444222111111111111100100100000000000000000000000042222000000000000000000
ffff9fffff9900090900000000000009000009000000000000002224221211111111111111110001110000000000000000000002242121000000000000000000
fff99fffff9900090900000000000009000009000000000000022424112111111111111111111000111000000000000000000024212111100100000000000000
fff9ffffff9900090000000000000009000000000000000002224421221111111111111111101000100100000000000000000241221111100000100000000000
9ff9f9ffff9900090000000000000000000000000000000222244212111111111111111111111110001010000000000000024212111121110001110000000000
9fff999ffff900000000000000000000000000000000002212212111111111111111111110111111001101000000000022242121111211111000000100000000
9fff99f9fff900000000000000000000000900000000222222221111111111111111111111111111000010100000000214221111112421111100000110000000
9fffff999ff990000000000000000000000900000002212212111111111111111111111111111111100010011002222222111111222421101100100001000000
9ff9fffff9ff99000000000000000000000900000222211221111112111111111111111111111111110000101122221211111112224211111110000010110000
9ffffff9f99ff9900000000000000000000000002212221111111122211111111111111111111111100000000011221111111122222111110111100001001000
0ff9ffffffff9ff99900000000000000000000222221111111111242111111111111111111111111111001001011111111112222224111111111100000001110
0ffffff9ff9f99fff999000000000000000021221211111111122242111111111111111111111111111100000001111111122121242111111111111000000001
00fffffffffff999fff9999000000000002212211111111111222421111111111111111111111111111111000100111122221221221111111111111110001011
00099f9ff9fff99f99ffff9900000002221221111111111112224211111111111111111111111101111111000001001221222224421110111101111111000000
00009999fffffff9999fffffffffff22221111111111111121242111111111111111111111111111111111100000010012222224221111111111111110100000
00000999ffffffffffffff9ff9ffffff211111191111111222411111111111111111111111111111111111110000100001224422111111111111111101111000
0000009999ffffffffffffffffff9fffff1111191111121242211111111111111111111111111111111101111000000000112221211111111111111111111110
0000000999999ffffffffff9f99f999fffff11191111212212111111111111111111111111111111111111111100000101011112111111111101111111111111
000000099099999f9fffffffff9f9ff9fffff1111112122421111111111111111111111111111111111111101110000000001111111111111111111111011110
00000000900009f999999fffffff99999fffff111221242221111111111111111111111111111111011111111110000000100011111111111111111111111111
000000009000000099999999fffffff99999fff12122422211111111111111111111111111111111111111111111100000001000111111111111111011111011
00000000900000002299f99ff99fff9ff9f99fff2222222111111111111111111111111111111111111111111111110000000001001111111111111111111110
000000009000000022219999f9ff9fff9f99ffff2241221111111111111111111111111111111111111111101111111000000000010011111111111111101111
00000000900000121111119999fff99999fff9fff222922111111111111111111111111111111111111111111111111110000000000000111111111111111111
0000000000002221111111199f999999999ff99fff22911111111111111111111111111111111111111111111111111111100000010000101111111111110101
000000000022111111111119f99999f9f9f99fff99f2911111111111111111111111111111111111111111111111111101110000000000000001111111111111
00000002121111111119111f9999f99999999999ffff911111111111111111111111111111111111111111111101111111111100000010010000101111111111
00122222111111111119111f9999999999f9f99999ff991111111111111111111111111111111111111111111111111111111110000000000000000001111111
22211111111111111119911f9f999f9ff9999ff999f9f99111111111111111111111111111111111111111111111111110111111100000000000000100000011
1111111111111111111991999999999999999999f999ff9111111111111111111111111111111111111111111111111111111111111000010001000000000100
1111111111111111119999999999999999999999f99999ff99111111111111111111111111111111111111111111111111111111111110000000001000000000
1111111111111111119999999444444444444999999999fff9991111111111111111111111111111111111111111111111111101111111100000000000001001
11111111111111119999994444444444444244444244449999999999111111111111111111111111111111111111111011111111111111111100000000000000
11111111111111999949444444444244442444444444424449999949999999111111111111111111111111111111111111111111111110111111000100010010
11111111191999944444424424444444444222444424244444244999999999499999911111111111111111111111111111111011111111111111100000000000
11111999999444444444444224424444244444444444444444424442499949999949994999111111111111111111111111111111111101111111011100000000
11999999944444242222444444444444422222222222222224444444444444424499999999949911111111111111111111111111111111111111111110000000
99999422242444444444444411111112222222222222212222222222244442444444444449999499991111111111111111111111111111111011111111110000
92244444441111222221222222221222122121212222222222222222222222244444242444249994949999911111111111111111110111111111111111111110
44444442222222122122222211112122212222222221222221121222212222222224444444442499249949949999991111111111111111111111011111110111
44422222221221222222211111111141110000000000000002222221122212221222222224244444499999999999999999111111111111111111111111111111
42222122212221111112111112111112111121111111112111111111111112122122112222244444424442449999444999999111111111111111111111111111
22121221112111111111111401111421111111111121111111111111111111122122122111112124222444444429999994499999999111111011111110111011
22111111111111121112111110000000000000040000112111112111112111111112222122122121122222244422449999994499999999911111111111111111
00111111200001111000000000000000011111111111111111121110111111111111111111111222212122112224222224499999444249991111111111111111
01110000111111111111111111111111111111110000000111111111111111121111111111114111112222212242142241222244424444449999111111111111
00000011000000111110001111111111100000001111111111111111112111111111111211111121111111222222122222222222424449999999999111101111
00111100111111100000000011111111111111111111111111111111111111111111114111111112111111111112222111221242222222442444999991111111
11111111111111111111111111111111111111111111111111111111111111111111111121111111111121114111111222211112222242222444444999999911
11111111111111111111110000111111111111111111111100111111111111111111111111111111121100000020011111112222111222222214424449999911
11111111111111111011111111100111111111000000011111111111111111111111111111111111111111211111111120011111222211121222241444499999
11111110011101111111100011111111111111111111100000000000100000000111110000000011111111111100200011110000111122221122224424444999
00011011101111111111111111100000000000000000000000000000011110000000001111110000000000111111111002004112100111112222122244244449
01111111111111111100000000000000000000000000000000000000000001111100000000001111111000000001111111100002111120111111221222444244
10111111111111111111111111111111111111111111111111111111110000000011111100000000000111111100000011111111110111111211112212122244
11001111111111110000000000000000000000000000000000000000001111111111100011111000000000000011111000001111111120211001111022212212
11110000000000000000000000000000000000000000000000000000000000000000011111111111111111100000000111100000111111110110211111012222
00000000000000000000000000000000000000000000000000000000000000000000000000000000011111011110000000011110000101111101100111110112
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111110001111011111112111111211102
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011100001111000111111111111111111210
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111100111111000111111111102101
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111011110000111110111120
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111011000011111101101
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111110000111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111100011011100
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111010111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111101101
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011011111010
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111101
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111110
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111
__sfx__
00020000083100831008310083100a3100b3100c3100f31010310143101731011310113101131011310133101431016310183101a310133101331013310143101631017310193101a3101c3101d3101e31021310
00020000045200452006520085200e52016520135200e520095200552005520095200f520155201d520145200f5200d5200c5200d520155201d5201b520125200e5200f52012520175201c520225202a52031520
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
012000000005001050000500105000050010500005001050040500505004050050500405005050040500505003050040500305004050030500405003050040500705008050070500805007050080500705008050
012000000c0550c0550c0550c0550c0550c0550c0550c05510055100551005510055100551005510055100550f0550f0550f0550f0550f0550f0550f0550f0551305513055130551305513055130551305513055
012000002762027620276202762027620276202762027620276202762027620276202762027620276202762027620276202762027620276202762027620276202762027620276202762027620276202762027620
012000003f3103f3103f3103f3003f3003f3103f3103f3003f3103f3103f3003f3103f3003f3103f3103f3103f3003f3103f3003f3003f3003f3103f3103f3103f3003f3003f3103f3103f3003f3003f3103f310
012000000061000610006100061000610006100061000610006100061000610006100061000610006100061000610006100061000610006100061000610006100061000610006100061000610006100061000610
012000000002400024000240002400024000240002400024000240002400024000240002400024000240002400024000240002400024000240002400024000240002400024000240002400024000240002400024
__music__
00 0a424344
03 0a0b4344
03 0c0d4344
03 0e0f4344

