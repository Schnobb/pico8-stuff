pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
 button={}
 button.left=0
 button.right=1
 button.up=2
 button.down=3
 button.x=4
 button.o=5
 
 enable_cls=true

 t=0
 t_delta=10
 t_up_timeout=0
 t_down_timeout=0
 
 button_timeout=0
 max_timeout=2
 
 inc=512
 inc_delta=8
 inc_up_timeout=0
 inc_down_timeout=0
 
 dx=-40
 
 cls()
end

function _update60()
 if btnp(button.x) then
  enable_cls=not enable_cls
 end

 if btn(button.up) then
  if t_up_timeout > 0 then
   t_up_timeout-=1
  else
	  t+=t_delta
	  t_up_timeout=max_timeout
	 end
 else
  t_up_timeout=0
 end
 
 if btn(button.down) then
  if t_down_timeout > 0 then
   t_down_timeout-=1
  else
   t-=t_delta
   t_down_timeout=max_timeout
  end
 else
  t_down_timeout=0
 end
 
 if btn(button.right) then
  if inc_up_timeout > 0 then
   inc_up_timeout-=1
  else
	  inc+=inc_delta
	  inc_up_timeout=max_timeout
	 end
 else
  inc_up_timeout=0
 end
 
 if btn(button.left) then
  if inc_down_timeout > 0 then
   inc_down_timeout-=1
  else
	  inc-=inc_delta
	  inc_down_timeout=max_timeout
	 end
 else
  inc_down_timeout=0
 end
end

function _draw()
 if enable_cls then
	 cls()
	end
	draw_fractal()		
 draw_status()
end

function draw_fractal()
 dx=min(-40+0.1*t,64)
 
 --srand(0)
 local x={}
 local y={}
 local xy_size=3
 for i=1,xy_size do
  x[i]=64+cos(i/xy_size+t*0.002)*60
  y[i]=64+sin(i/xy_size+t*0.002)*60
  --pset(x[i],y[i],7+i)
 end
 
 n=0
 local x0=x[1]
 local y0=y[1]
 for i=1,inc do
  n=flr(rnd(#x))+1
  x0=(x[n]+x0)/2
  y0=(y[n]+y0)/2
  local col=8+(t/40 + rnd(1))%8
  pset(x0-16,y0,col)
  pset(128-x0+16,y0,col)
  --pset(x0,y0,col)
 end
 
 x0=0 x=1
 
 while(x<dx) do
  for y=8,127 do
   local col=pget(x,y)
   if col>0 then
    col=8 + ((col-8)+x/5)%8
   end
	  line(x0,y,x,y,col)
   line(128-x0,y,128-x,y,col)
  end
  x0=x
  x=x+4+sin(x/40)*2
 end
end

function draw_status()
 rectfill(0, 0, 127, 8, 5)
 local status="frame:"..t
 status=status.."; inc:"..inc
 status=status.."; cls: "..tostr(enable_cls)
 print(status, 1, 2, 7)
end
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000047500275184750c475184750c4700c2310a17100470004700c475184700c2750c4750a1711817500175002750c372001750c472002750c175182720047518476001750c47518172002760c47218172
0110000017373003001f3722b0253b6551837300300003001837300300183032b305306553c37518273003001837318303243032b33239655243051f3000030018373183033c603183033b655303053960500300
01100000185762476624555187422477518562247552654218775247662455618745245721a76624755265421b77527767275521b745275722676527752297471857624765247421857524762267561854522772
0110000018572245752457218575245721857524572265761857526572275711b572275751b57227575295751f5722b575295711f5752b5751f575295722b5761f5721d5771b5751f5722b577295752c5722e576
011000000847514352144730835514475083421347514355084771446314375084521447608466143721645508472143471447308452143771446508376144520847214365084731445514372084451647614455
011000000547511455113720546511472054551147511242054751145505472113651147705456111771446605475113520547511445114720545511272144650547514352054751446514272114551447216445
01100000085760c5440f57616544085760c5440f57614544085760c5440f57613544085760c5440f57613544085760c5440f57614544085760c5440f57616544085760c5440f57613544085760c5450f5761b545
011000001337313373003000030037655003002b4753747518373003000030018373376550030018373003001837318373003000030037655003002b475374751837300300003001837337655003001f47300300
011000002457524525240750050024075245750000024575000002457524075305752407524575000002457524075005003007524575240753057500000245750000024575300750050024075305753007524575
01100000301762e2662e4562b3462b3762946627756271462757627276244662436622776221761f5661f2661d4761d3761b7661b5661b17618276164661636613776115760f1660f2660c4760c3760c7660a566
__music__
00 01420344
00 01420444
01 01020308
00 01020444
00 05080308
00 05420408
00 06020344
00 0602034a
00 01020309
00 0108030a
00 01024344
00 01024744
00 08064744
00 08050a44
00 01020844
02 0102084a

